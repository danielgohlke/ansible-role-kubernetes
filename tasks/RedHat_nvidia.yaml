# In CentOS we must assume that drivers are already installed
- name: Check nvidia is installed
  stat:
    path: /var/lib/dkms/nvidia
  register: nvidia_inst

- fail:
    msg: It seems that NVIDIA drivers are not installed.
  when: not (nvidia_inst.stat.isdir is defined and nvidia_inst.stat.isdir)

- name: Download nvidia-docker yum repo
  get_url:
    url: https://nvidia.github.io/nvidia-docker/{{ansible_distribution | lower}}{{ansible_distribution_version}}/nvidia-docker.repo
    dest: /etc/yum.repos.d/nvidia-docker.repo

- name: Add nvidia repo key
  rpm_key:
    state: present
    key: https://nvidia.github.io/nvidia-docker/gpgkey

- name: Install nvidia-docker2 package
  yum: name=nvidia-docker2

- set_fact:
    docker_options: "{{ docker_options | combine(docker_nvidia_options) }}"
